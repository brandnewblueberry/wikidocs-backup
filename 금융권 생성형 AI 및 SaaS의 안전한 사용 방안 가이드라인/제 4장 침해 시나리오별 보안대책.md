# 제 4장: 침해 시나리오별 보안대책

## 1. 개요

오늘날의 디지털 환경은 점점 더 복잡하고 상호 연결되어 있으며, 이로 인해 기업과 개인은 다양한 사이버 위협에 노출되고 있다. 이러한 위협에 효과적으로 대처하기 위해서는 체계적이고 포괄적인 보안 대책이 필요하다. 본 장에서는 Cloud Security Alliance(CSA)의 위협 분류에 따른 주요 침해 시나리오를 식별하고, 각각의 시나리오에 대한 적절한 대응 방안을 제시한다. 이를 통해 조직이 사이버 보안 위험을 사전에 식별하고 완화할 수 있는 역량을 강화할 수 있을 것으로 기대한다.

## 2. CSA 위협 분류에 따른 시나리오 및 대응 방안
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misconfiguration & Inadequate Change Control</title>
</head>
<body>
    <h1>1. Misconfiguration & Inadequate Change Control</h1>

    <h2>취약 시나리오 배경</h2>
    <p>구성 오류 및 잘못된 구성 설정은 클라우드 컴퓨팅 환경에서 가장 큰 보안 위협 중 하나로, 의도치않은 데이터 노출이나 악의적인 공격에 취약해질 수 있다. 클라우드 환경에서는 다양한 서비스와 리소스가 상시 연결되어 복잡하게 운영되기 때문에 작은 설정 실수도 광범위한 영향을 미칠 수 있기 때문이다.</p>
    <p>주요 원인으로는 모니터링 및 로깅이 비활성화 되어있거나, ICMP (Internet Control Message Protocol) 포트가 열려있는 경우, 보안 설정 없이 자동 백업이 되는 경우, 클라우드 리소스에 대한 과도한 접근권한 설정등이 포함된다. 이러한 설정 오류는 악의적인 의도 없이 보안 지식 미흡으로 인해 발생할 수 있지만, 그 영향은 데이터 유출, 시스템 성능 저하, 법적 문제 등 치명적인 문제를 초래할 수 있다.</p>
    <p>따라서 클라우드 설정을 정기적으로 모니터링하고 검토해야하며, 변경 관리 및 보안 규정을 철저히 준수하는 것이 중요하다.</p>
 <img src="https://wikidocs.net/images/page/267442/image_8.png"> 
    <p>해당 아키텍쳐에서는 Amazon S3, Amazon Bedrock, Amazon ECS, Amazon WAF 등 네가지 서비스 및 리소스가 사용된다. 이는 생성형 AI를 통해 고객의 금융 패턴과 선호도를 분석하여 맞춤형 금융 상품을 추천하는데 사용될 수 있는 아키텍쳐이다. 이 과정에서 SaaS 환경과 연계된 OpenAI가 S3를 사용하여 데이터를 저장하거나 처리 할 수 있다.</p>

    <h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/image_9.png">

    <h2>공격/유출 과정 설명</h2>
    <p>해당 시나리오는 웹 애플리케이션의 잘못 구성된 WAF 보안 규칙을 전제로 한다.</p>
    <ol>
        <li>
            <strong>Client (Hacker) 의 요청</strong>
            <p>해커는 OpenAI가 연결된 웹 애플리케이션의 URL 입력 필드 또는 API endpoint를 악용하여 SSRF (Server-Side Request Forgery) 공격을 시도한다.</p>
            <p>AWS WAF (Amazon Web Application Firewall) 규칙의 취약점을 활용하게 되는데, 구체적인 경우는 WAF가 특정 URL 패턴이나 헤더만 검증하도록 구성되었거나, 입력 값 검증이 제대로 이루어지지 않은 경우 등이 있다.</p>
            <p>해당 공격으로 인해 Amazon EC2 인스턴스 내부에서 실행되도록 설계하며, 이를 통해 IMDSv2 (AWS의 인스턴스 Metadata Server)에 요청을 전송하게 된다.</p>
        </li>
        <li>
            <strong>IAM 권한 탈취</strong>
            <p>해커가 성공적으로 IMDSv2에 요청을 전송하게 될 시, EC2 인스턴스에 연결된 IAM 역할의 임시 자격증명 (Access Key, Secret Key, Session token)을 획득할 수 있다.</p>
            <p>해당 자격증명은 EC2 인스턴스 메타데이터 서비스에서 제공되며, IAM 역할에 부여된 권한에 따라 AWS 리소스에 접근할 수 있는 권한을 부여한다.</p>
        </li>
        <li>
            <strong>Amazon S3 접근</strong>
            <p>S3 버킷이 Public Access를 허용했거나, 적절한 보안 설정이 구성되지 않았다는 가정하에 해커는 데이터를 손쉽게 다운로드 하거나 검색할 수 있다.</p>
        </li>
        <li>
            <strong>고객 데이터 유출</strong>
            <p>3단계에서 접근할 수 있었던 S3 버킷에는 고객의 민감한 개인정보 (예: 이름, 주소, 신용정보 등)이 저장되어 있었으며, 해커는 다운로드를 통해 데이터를 복사하거나 외부 서버로 전송할 수 있다.</p>
        </li>
    </ol>

    <h2>대응책</h2>
    <p>해당 시나리오를 예방할 수 있는 대응책으로는 가장 먼저 WAF 규칙을 강화하여 SSRF 공격을 사전에 막는 것이 중요하다. URL 입력 필드나 API 에서 사용자 입력값을 철저히 검증하여 내부 네트워크로의 요청을 차단하고, 허용된 도메인 또는 IP만 요청 가능하도록 Whitelist 기반 필터링이 필요하다. 아래 예시코드와 같이 실현할 수 있다.</p>
    <pre>
<code>{
  "WAFConfiguration": {
    "Rules": [
      {
        "Name": "SSRFPrevention",
        "Action": "BLOCK",
        "Condition": {
          "Field": "URI",
          "Whitelist": [
            "https://api.whitelisted-domain.com",
            "https://allowed-domain.com"
          ]
        }
      }
    ],
    "Monitoring": {
      "LogDestination": "arn:aws:s3:::waf-logs",
      "Alerting": {
        "SuspiciousRequests": "Enabled",
        "Threshold": 10,
        "Action": "NotifyAdmin"
      }
    }
  }
}</code>
    </pre>
    <p>그밖에도, WAF의 로그를 모니터링하여 의심스러운 요청이나 IP 주소에 대한 실시간 경고를 설정하는 것이 중요하다.</p>
    <p>EC2 인스턴스 단에서의 보호로는 IMDS에 대한 요청을 차단하거나, 내부 네트워크에서 요청을 감지하는 IDS (침입탐지 시스템)을 설정하는 것이 도움이 된다. 또한 보안그룹을 통해 신뢰할 수 있는 IP 주소만 허용하고, 필요하지 않은 포트를 차단하는 방법도 있다.</p>
    <pre>
<code>{
  "EC2Security": {
    "IMDS": {
      "Enabled": true,
      "Version": "IMDSv2",
      "BlockUnauthenticatedRequests": true
    },
    "IDS": {
      "Service": "AWS Network Firewall",
      "Rules": [
        {
          "Name": "DetectIMDSAccess",
          "Condition": "UnusualPattern",
          "Action": "Alert"
        }
      ]
    },
    "SecurityGroupRules": [
      {
        "IpProtocol": "tcp",
        "FromPort": 22,
        "ToPort": 22,
        "CidrIp": "203.0.113.0/32",
        "Description": "Allow SSH from trusted IP"
      },
      {
        "IpProtocol": "tcp",
        "FromPort": 0,
        "ToPort": 65535,
        "CidrIp": "0.0.0.0/0",
        "Action": "DENY",
        "Description": "Deny all other traffic"
      }
    ]
  }
}</code>
    </pre>
    <p>마지막으로 Storage의 보안 강화를 위해서 S3 버킷의 액세스 권한이 Public으로 되어있는지 검토해야하며, 할당된 정책이 암호화가 되어있는지 점검하는 등의 조치가 필요하다.</p>    
</body>
</html>
<body>
    <h1>2. Identity & Access Mgmt (IAM)</h1>
    
    <h2>인증 및 엑세스 제어 Identity & Access Mgmt (IAM)</h2>
    <blockquote>
        <p><strong>사용자 질문의 키워드를 OpenAI API를 통해 찾아내어 자동으로 담당자를 찾아주는 Slack Bot</strong></p>
    </blockquote>

    <h3>취약 시나리오 배경</h3>
    <p>
        이 아키텍처는 사용자가 Slack에서 질문을 입력하면, 자동으로 OpenAI API를 통해 해당 질문의 핵심 키워드를 추출하고, 이를 기반으로 담당자를 찾아주는 Slack Bot 시스템이다. 
        시스템은 Slack 메시지를 API Gateway를 통해 Lambda로 전달하고, Lambda는 OpenAI API를 호출하여 사용자의 질문에서 키워드를 추출한다. 
        이후 추출된 키워드를 바탕으로 DynamoDB에서 담당자 리스트를 조회하여 해당 담당자를 사용자에게 응답으로 전달한다. 
        이 과정을 통해 사용자는 빠르고 효율적으로 필요한 정보를 실시간으로 확인할 수 있다.
    </p>
    <p>
        그러나 해당 아키텍처의 설계 과정에서 발생할 수 있는 몇 가지의 보안 취약점이 존재하며, 그로 인해 민감한 정보가 유출될 위험이 있다. 
        다음의 시나리오에서는 Slack API, API Gateway, Lambda, 그리고 DynamoDB 간의 통합 과정에서 초래될 수 있는 리버스쉘 공격을 다룬다.
    </p>
    
<img src="https://wikidocs.net/images/page/267442/1122_%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%8E%98%EC%9D%B4%EC%A7%80-1.drawio.png">
    
    <h3>시나리오 구상도</h3>
<img src="https://wikidocs.net/images/page/267442/1122_%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%ED%8E%98%EC%9D%B4%EC%A7%80-2.drawio.png">
    
    <h3>공격/유출 과정 설명</h3>
    <ol>
        <li>
            <strong>네트워크 트래픽에서 Request URL 탈취</strong>
            <p>
                API endpoint와 Slack 이벤트와의 통합을 설정할 때 HTTP를 사용하도록 잘못 설정하여 통신이 암호화되지 않았다. 
                공격자는 Man-in-the-Middle (MITM) 공격을 통해 Slack과 API Gateway 간의 통신을 가로채는 트래픽 스니핑을 수행한다.
            </p>
        </li>
        <li>
            <strong>Slack API 요청 위조</strong>
            <p>
                <code>X-Slack-Signature</code> 검증 로직의 결함을 이용해 인증된 Slack의 요청처럼 보이도록 위조된 요청을 전송한다. 
                Slack 이벤트와 유사한 JSON 페이로드를 생성하여 URL로 요청을 보낸다. 이로 인해 리버스 쉘 연결이 생성된다.
            </p>
            <pre>
<code>{
  "type": "event_callback",
  "event": {
    "type": "message",
    "channel": "C12345",
    "text": "run malicious_command",
    "user": "U67890"
  }
}
</code>
            </pre>
        </li>
        <li>
            <strong>API Gateway 검증 실패</strong>
            <p>
                <code>X-Slack-Signature</code> 및 <code>X-Slack-Request-Timestamp</code>를 제대로 검증하지 않아 위조된 요청이 수락된다.
            </p>
        </li>
        <li>
            <strong>Lambda에서 IAM 자격증명 탈취</strong>
            <p>
                공격자는 Lambda에서 다음 명령을 사용하여 IAM 자격 증명을 획득한다:
            </p>
            <pre>
<code>curl http://169.254.169.254/latest/meta-data/iam/security-credentials/</code>
            </pre>
        </li>
        <li>
            <strong>민감 데이터 조회 및 탈취</strong>
            <p>
                Lambda의 IAM 역할 권한이 와일드카드로 설정되어 있었음을 이용하여 DynamoDB에서 민감한 데이터를 조회하고 탈취한다.
            </p>
        </li>
    </ol>
    
    <h3>대응책</h3>
    <ol>
        <li>
            <strong>X-Slack-Signature 및 X-Slack-Request-Timestamp 검증 강화</strong>
            <p>Slack Signature와 Timestamp 검증을 강화하여 위조된 요청을 차단한다. 서버는 Slack에서 전달하는 모든 이벤트에 대해 서명과 타임스탬프를 정확히 검증해야 한다. 만일 서명 또는 타임스탬프가 잘못된 경우 요청을 즉시 거부한다. 서명 검증에 실패한 요청을 로그로 기록하고, 의심스러운 활동을 모니터링하여 사전 대응할 수 있도록 한다.</p>
            <pre>
<code>{
  "Version": "2024-11-22",
  "Statement": [
    {
      "Sid": "SlackSignatureVerification",
      "Effect": "Allow",
      "Action": [
        "lambda:InvokeFunction"
      ],
      "Resource": "arn:aws:lambda:region:account-id:function:verify-signature"
    }
  ]
}
</code>
            </pre>
        </li>
        <li>
            <strong>강력한 인증 및 권한 부여</strong>
            <p>OAuth 인증을 사용하여 Slack과의 연결을 강화하고, 각 API 요청에 대한 인증 토큰을 요구하여 무단 액세스를 차단한다. 또한, API Gateway에서 IAM 역할 기반 인증을 활용하여 유효한 토큰만 API를 호출할 수 있도록 한다. API Gateway에서 IAM 권한을 통해 요청을 인증하고, 서명된 요청만을 처리하도록 설정한다. 이를 통해 유효하지 않은 요청을 차단한다.</p>
            <pre>
<code>{
  "Version": "2024-11-22",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "execute-api:Invoke",
      "Resource": "arn:aws:execute-api:region:account-id:api-id/stage/method/endpoint"
    }
  ]
}
</code>
            </pre>
        </li>
        <li>
            <strong>API Gateway Rate Limiting 및 IP 필터링</strong>
            <p>요청 속도 제한(Rate limiting)을 설정하여 공격자가 대량의 요청을 보내는 것을 방지한다. 또한, IP 화이트리스트나 IP 블랙리스트를 사용하여 신뢰할 수 있는 IP만 요청을 보낼 수 있도록 한다.</p>
            <pre>
<code>{
  "resource": "/example",
  "httpMethod": "GET",
  "action": "aws:invoke",
  "condition": {
    "IpAddress": {
      "aws:SourceIp": "192.168.0.1"
    }
  }
}
</code>
            </pre>
        </li>
        <li>
            <strong>Lambda IAM 최소 권한 원칙 및 역할 세분화</strong>
            <p>Lambda의 IAM 역할을 할당할 때, 필요한 최소한의 권한만 부여해야 한다. DynamoDB에 접근할 수 있는 권한을 부여하되, 와일드카드를 사용하지 않고 특정 테이블과 특정 작업에만 접근하도록 제한한다. Lambda가 접근할 수 있는 리소스를 구체적으로 지정하여, 불필요한 리소스에 대한 권한을 제한한다.</p>
            <pre>
<code>{
  "Version": "2024-11-22",
  "Statement": [
    {
      "Effect": "Allow

",
      "Action": [
        "dynamodb:Query",
        "dynamodb:Scan"
      ],
      "Resource": "arn:aws:dynamodb:region:account-id:table/your-table-name"
    }
  ]
}
</code>
            </pre>
        </li>
        <li>
            <strong>Lambda 실행 환경 보안 강화</strong>
            <p>Lambda 함수의 보안 그룹을 통해 인바운드 및 아웃바운드 트래픽을 제어한다. 또한, Lambda 함수 내에서 외부 명령어 실행을 금지하거나 제한한다. <code>os.system</code>, <code>subprocess</code> 등을 사용하여 외부 명령어를 실행하지 않도록 한다. 외부 요청을 처리하는 함수에서는 인풋 검증 및 필터링을 통해 악의적인 페이로드가 실행되지 않도록 한다. 정기적으로 Lambda의 보안 구성이 미비한 경우를 점검하고, 필요한 보안 패치 및 업데이트를 수행한다.</p>
        </li>
        <li>
            <strong>CloudWatch Logs 및 CloudTrail을 통한 모니터링</strong>
            <p>CloudWatch Logs와 CloudTrail을 사용하여 Lambda 함수에서 발생하는 모든 요청과 이벤트를 기록하고 모니터링한다. 예상치 못한 API 호출, Lambda 함수에서 외부 시스템으로의 연결 시도 등 비정상적인 행동을 실시간으로 감지하고 알림을 설정한다.</p>
        </li>
        <li>
            <strong>DynamoDB 쿼리 결과 모니터링</strong>
            <p>DynamoDB의 쿼리 결과에 대한 필터링과 로그 기록을 강화하여 의심스러운 활동을 추적한다.</p>
        </li>
    </ol>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insecure Interfaces and APIs</title>
</head>
<body>
    <h1>3. Insecure Interfaces and APIs</h1>

    <h2>취약 시나리오 배경</h2>
    <p>
        불안전한 인터페이스와 API 관리미흡은 클라우드 환경에서 발생하는 보안 위협 중 하나로, 잘못된 API 인증, 권한 관리, 데이터 노출, 속도 제한의 부재 등이 주요 원인이 될 수 있다. 
        클라우드 서비스는 대부분 API를 통해 기능을 제공하고, 이는 클라우드와 애플리케이션간의 핵심적인 연결고리이자 가장 자주 공격 당하는 지점 중 하나이기 때문에 
        보안 조치가 간과될 시, 치명적인 결과를 초래할 수 있다.
    </p>
<img src="https://wikidocs.net/images/page/267442/image_10.png" alt="Insecure Interfaces and APIs Architecture">
    <p>
        해당 아키텍쳐는 서버리스 채팅 애플리케이션을 빌드한다. (Serverless Stack), DynamoDB, Lambda 등의 서비스 및 리소스가 사용되었다. 
        잘못된 CORS 설정으로인해서 CloudFront URL을 통해 S3 버킷에 직접 접근 시도가 가능하거나, 외부 AI 서비스인 ChatGPT를 호출하는 과정에서 
        악성 요청으로 변조될 경우, 민감 데이터의 유출 가능성이 존재한다.
    </p>

   <h2>시나리오 구상도</h2>
   <img src="https://wikidocs.net/images/page/267442/3.png" alt="Image from Wikidocs" />
    
   <h2>공격/유출 과정 설명</h2>
    <ol>
        <li>
            <strong>API endpoint 탐색</strong>
            <p>
                공격자는 대상 클라우드 서비스가 제공하는 API Endpoint를 탐색하는 것으로 공격을 시작한다. 공개된 API 문서나 자동화 도구를 사용하여 
                사용가능한 API 목록을 수집하고, 인증여부와 권한 검증이 제대로 이루어지지않는 endpoint를 식별한다. 이를 위해서 Burp Suite, Postman 등과 같은 
                도구로 endpoint를 호출하여 요청과 응답을 분석한 후, 데이터의 반환을 분석해야한다. 해당 과정의 결과로 공격자는 인증없이 호출 가능한 
                엔드포인트와 API 응답에 사용자 ID 혹은 세션 토큰 등과 같은 민감한 정보를 수집할 수 있다.
            </p>
        </li>
        <li>
            <strong>인증 우회</strong>
            <p>
                앞선 단계에서 인증되지 않은 상태에서 중요한 endpoint를 호출하여 정상적인 응답이 반환되는지 확인해야한다. 예시로, ‘/admin/users/’ 와 같은 관리 기능을 
                호출할 때 인증 없이 사용자 데이터를 반환하게 된다면, 인증 우회 취약점이 존재하고 있음을 알 수 있다. 이를 이용하여 일반 사용자 자격증명을 사용해 
                관리 endpoint에 접근가능한지 테스트 하며, 권한 검증이 미흡한 점을 악용한다.
            </p>
        </li>
        <li>
            <strong>권한 탈취 및 데이터 접근</strong>
            <p>
                공격자는 API 요청을 변조하거나 토큰 만료 정책의 미흡한 부분을 활용하여 관리자 권한을 탈취하거나, 민감한 데이터에 접근한다. 이 결과로 서비스의 데이터를 
                검색하거나 다운로드 하는 API Endpoint를 호출할 수 있다. 따라서, Amazon S3와 같은 저장소에 접근할 수 있는 API를 호출하거나, 데이터베이스 백업 파일을 
                다운로드 하는 등의 요청으로 민감한 정보를 탈취하게 된다.
            </p>
        </li>
        <li>
            <strong>고객 데이터 유출</strong>
            <p>
                탈취한 정보들을 다운로드 하여 공격자의 외부서버로 전송할 수 있다. 이 데이터에는 고객의 이름, 이메일, 신용 정보 등 다양한 민감 정보가 포함될 수 있다.
            </p>
        </li>
    </ol>

    <h2>대응책</h2>
    <p>
        대응책은 다음과 같다. 먼저, 모든 API 요청에 대해 철저한 인증 절차를 적용해야 한다. OAuth 2.0이나 OpenID Connect와 같은 표준 인증 방식을 사용하고, 
        토큰 기반 인증을 통해 권한을 세분화하며, 만료된 토큰이나 잘못된 토큰으로 접근을 시도할 경우 이를 즉시 차단해야 한다. 특히, 관리자 권한이 필요한 API는 
        추가적인 인증 절차로 MFA를 요구하도록 설정해야 한다.
    </p>
    <pre>
<code>{
  "Authentication": {
    "Method": "OAuth 2.0",
    "TokenValidation": {
      "ExpiredTokenAction": "Block",
      "InvalidTokenAction": "Block"
    },
    "AdminAPI": {
      "RequireMFA": true
    }
  }
}
</code>
    </pre>
    <p>
        속도 제한과 요청 차단도 중요하다. API Gateway나 CloudFront를 활용해 시간당 요청 수를 제한하고, 비정상적인 트래픽 패턴이 감지될 경우 이를 즉시 차단해야 한다. 
        WAF(Web Application Firewall)를 활용해 브루트 포스 공격과 같은 반복적인 인증 시도도 방어할 수 있도록 설정해야 한다. 아래 예시코드와 같이 설정할 수 있다.
    </p>
    <pre>
<code>{
  "RateLimiting": {
    "MaxRequestsPerHour": 1000,
    "ActionOnLimit": "Block",
    "Monitoring": "Enabled"
  },
  "WAFRules": [
    {
      "Name": "BruteForceProtection",
      "Action": "BLOCK",
      "Condition": {
        "FailedLoginAttempts": 5,
        "TimeWindow": "10 minutes"
      }
    }
  ]
}
</code>
    </pre>
    <p>
        API 응답에 민감한 데이터가 포함되지 않도록 철저히 검증해야 하며, 필요한 데이터만 응답에 포함시키고 민감한 데이터는 TLS(SSL)로 암호화해 전송해야 한다. 
        또한, 로그와 디버깅 메시지에 인증 정보가 포함되지 않도록 설정을 강화해야 한다.
    </p>
    <p>
        코드 저장소를 정기적으로 검사하여 노출된 API 키, 비밀번호, 인증 정보가 없는지 확인해야 한다. GitGuardian, Trufflehog와 같은 도구를 활용해 자동화된 탐지 프로세스를 
        도입하고, 노출된 정보가 발견되면 즉시 무효화하고 새 키를 발급해야 한다. 코드 저장소의 경우 아래와 같이 설정할 수 있다.
    </p>
    <pre>
<code>{
  "CodeRepositoryScanning": {
    "Tools": ["GitGuardian", "Trufflehog"],
    "Frequency": "Weekly",
    "ActionsOnDetection": {
      "InvalidateKey": true,
      "GenerateNewKey": true
    }
  }
}
</code>
    </pre>
    <p>
        Cross-Origin Resource Sharing(CORS) 정책도 강화해야 한다. 신뢰할 수 있는 도메인에서만 API를 호출할 수 있도록 허용하며, `Access-Control-Allow-Origin` 헤더를 
        특정 도메인으로 제한해야 한다. 아래와 같이 설정할 수 있다.
    </p>
    <pre>
<code>{
  "CORSConfiguration": {
    "AllowedOrigins": ["https://trusted-domain.com"],
    "Methods": ["GET", "POST", "PUT"],
    "Headers": ["Authorization", "Content-Type"]
  }
}
</code>
    </pre>
    <p>
        정기적인 취약점 점검을 통해 SQL Injection, XSS, SSRF와 같은 공격에 대한 API의 내성을 강화해야 하며, CloudTrail과 CloudWatch를 사용해 API 호출 로그를 
        지속적으로 모니터링해야 한다. 비정상적인 요청이 감지되면 경고를 설정하고 AWS Config를 통해 리소스의 보안 상태를 실시간으로 점검해야 한다.
    </p>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inadequate Selection/Implementation of Cloud Security Strategy</title>
</head>
<body>
<h1>4. Inadequate Selection/Implementation of Cloud Security Strategy</h1>

    <h3>배경</h3>
    <p>
        클라우드 기반 아키텍처는 사내 채팅 서비스인 Slack과 Amazon Web Services(AWS)의 다양한 기능을 결합하여, Slack에서 쿼리 및 파일을 처리하고, 
        OpenAI API와 Amazon Kendra를 사용하여 문서 검색을 제공하는 시스템이다. 이 시스템은 Lambda 함수, API Gateway, DynamoDB, Kendra 및 OpenAI API를 포함하며, 
        Slack을 통해 민감한 데이터나 파일을 처리한다. 그러나 이 아키텍처는 보안 측면에서 여러 취약점을 노출하고 있으며, ISO 27001, ISO 27002와 같은 보안 규정을 준수하지 않으면 
        보안 사고로 이어질 위험이 있다.
    </p>

    <h3>문제 발생 (Optional)</h3>
    <p>
        기업은 보안 규정을 준수하지 않은 몇 가지 취약점을 노출하고 있으며, 이는 보안 사고의 원인이 될 수 있다.
    </p>
    <ol>
        <li>
            <strong>적절한 데이터 암호화 부족</strong>
            <ul>
                <li>시스템 간 데이터 전송 및 저장 시 적절한 암호화가 이루어지지 않음.</li>
                <li>OpenAI API 키와 같은 민감한 정보가 Lambda 함수의 환경 변수에 저장되어 암호화되지 않음.</li>
            </ul>
        </li>
        <li>
            <strong>접근 제어 미비</strong>
            <ul>
                <li>IAM 사용자 및 Lambda 함수에 과도한 권한 부여로 인해 불필요한 접근 권한이 발생.</li>
                <li>Lambda 함수에 와일드카드 <code>lambda:*</code> 권한이 부여되어 모든 Lambda 함수에 접근 가능.</li>
                <li>IAM 정책에서 과도한 권한 부여로 보안 사고가 발생할 위험이 있음.</li>
            </ul>
        </li>
        <li>
            <strong>로그 및 모니터링 부족</strong>
            <ul>
                <li>시스템에서 발생하는 중요한 이벤트나 오류에 대한 로그가 충분히 기록되지 않음.</li>
                <li>AWS 관리 콘솔에 대한 접근 및 Lambda 함수의 권한 변동을 모니터링하지 않음.</li>
            </ul>
        </li>
        <li>
            <strong>적절한 인증 및 접근 통제 부재</strong>
            <ul>
                <li>기업의 AWS 관리 콘솔에 대한 IP 제한이 설정되어 있지 않아 공격자가 외부에서 쉽게 로그인할 수 있음.</li>
            </ul>
        </li>
    </ol>

    <h3>공격 및 유출 과정</h3>
    <ol>
        <li>
            <strong>피싱 이메일 및 Slack 파일 업로드</strong>
            <p>
                공격자는 피싱 이메일을 통해 악성 파일을 Slack 채널에 업로드하도록 유도. 파일은 Slack과 Lambda 연동 시스템을 통해 
                OpenAI API 임베딩 분석을 수행하는 과정에서 악성 스크립트를 주입.
            </p>
        </li>
        <li>
            <strong>AWS 관리 콘솔 접근</strong>
            <p>
                탈취한 AWS 자격 증명으로 공격자는 AWS 관리 콘솔에 접근, Lambda 함수의 권한을 수정하여 민감한 데이터를 유출할 수 있음.
            </p>
        </li>
        <li>
            <strong>IAM 사용자의 인라인 및 관리형 정책 접근</strong>
            <p>
                <code>lambda:*</code> 와일드카드 설정을 통해 모든 Lambda 함수에 대한 접근 및 수정 권한을 확보. Lambda 환경 변수에서 OpenAI API 키를 탈취하고 
                무단 API 호출로 민감한 정보를 외부로 유출.
            </p>
        </li>
        <li>
            <strong>OpenAI API 무단 접근</strong>
            <p>
                탈취한 OpenAI API 키를 사용해 OpenAI API를 무단 호출, 기업의 데이터베이스에서 민감한 정보를 추출.
            </p>
        </li>
    </ol>

    <h3>해결 전략 및 보안 개선 방안</h3>
    <ol>
        <li>
            <strong>적절한 데이터 암호화 부족</strong>
            <p>
                ISO 27002: 10.1.1 - 암호화 관리 규정을 준수하여 데이터 전송 및 저장 시 강력한 암호화 프로토콜을 적용한다.
                OpenAI API 키 및 민감한 정보를 Secrets Manager에 저장하고 암호화된 방식으로 접근한다.
            </p>
        </li>
        <li>
            <strong>접근 제어 미비</strong>
            <p>
                ISO 27002: 9.4.1 - 접근 권한 관리 규정을 준수하여 정보 시스템 및 서비스에 대한 접근 권한을 필요 최소한으로 제한한다.
                불필요한 권한을 제거하고, 정기적으로 IAM 사용자 및 Lambda 함수의 권한을 검토한다.
            </p>
            <p>
                <code>lambda:*</code> 와일드카드 권한을 제거하고 필요한 리소스만을 지정하여 권한을 제한한다.
            </p>
        </li>
        <li>
            <strong>로그 및 모니터링 부족</strong>
            <p>
                ISO 27002: 12.4.1 - 감사 기록 생성 및 보호 규정을 준수하여 AWS CloudTrail 및 Amazon GuardDuty를 사용하여 
                모든 API 호출과 보안 이벤트를 모니터링하고, 비정상적인 활동을 실시간으로 탐지한다.
            </p>
        </li>
        <li>
            <strong>적절한 인증 및 접근 통제 부재 (SSO 설정 문제)</strong>
            <p>
                ISO 27002: 9.2.3 - 사용자 접근 권한 검토 규정을 준수하여 AWS 관리 콘솔의 IP 접근 제한을 설정하고, 
                외부 공격자가 내부 시스템에 접근하는 것을 차단한다.
            </p>
        </li>
    </ol>
</body>
</html>
<h1>5. Insecure Third-Party Resources</h1>

<h2>취약 시나리오 배경</h2>
<p>
    금융 회사는 고객의 신용 데이터를 분석하고 대출 승인을 자동화하는 금융 AI 시스템을 SaaS(Software as a Service) 환경에서 구축한다. 
    이 시스템은 AWS 기반 클라우드에서 실행되며, Apache Struts 2와 같은 오픈소스 프레임워크를 활용하여 SaaS 애플리케이션을 구성한다. 
    그러나 Apache Struts 2의 원격 코드 실행(RCE) 취약점(CVE-2017-5638)이 포함된 버전을 사용하였고, 해당 취약점에 대한 사전 검증 및 보안 패치가 미흡한 상태에서 배포된다.
</p>
<p>
    이로 인해 공격자는 SaaS 애플리케이션의 백엔드 시스템에 접근할 수 있었으며, 민감한 개인정보(고객 신용 정보, 거래 내역 등)를 유출하거나 데이터를 조작할 수 있다. 
    AWS WAF(Web Application Firewall)와 같은 보안 장치는 배치되었지만, 설정이 미흡하거나 Apache Struts 2의 취약점에 대한 방어 규칙이 부족하여 공격자가 이를 손쉽게 우회한다.
</p>
<img src="https://wikidocs.net/images/page/267442/Insecure_Third-Party_Resources_%E1%84%89%E1%85%B5%E1%84%82%E1%85%A1%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A9_%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5_%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%E1%84%83%E1%85%A9.png">
<p>
    해당 아키텍처는 AWS WAF, AWS EC2, RDS, VPC와 같은 주요 서비스 및 리소스를 포함한다. AWS WAF는 SaaS 애플리케이션에 대한 공격을 방어하기 위해 사용되며, 
    AWS EC2는 금융 AI 애플리케이션이 실행되는 컨테이너 환경을 제공하며, RDS는 고객 데이터를 안전하게 저장하는 데이터베이스 역할을 한다. 
    VPC는 이러한 모든 리소스를 외부 위협으로부터 격리하여 보호한다.
</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/Insecure_Third-Party_Resources_%E1%84%80%E1%85%A9%E1%86%BC%E1%84%80%E1%85%A7%E1%86%A8_%E1%84%89%E1%85%B5%E1%84%82%E1%85%A1%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A9_%E1%84%80%E1%85%AE%E1%84%89%E1%85%A1%E1%86%BC%E1%84%83%E1%85%A9.png" >
<p>시나리오 구상도 설명</p>

<h2>공격/유출 과정 설명</h2>
<p>
    해당 시나리오는 금융 AI 시스템의 Apache Struts 2 RCE 취약점을 악용하여 SaaS 애플리케이션의 금융 AI 시스템 데이터를 유출하는 과정을 기반으로 한다. 
    공격자는 취약한 오픈소스 라이브러리, 미흡한 보안 설정, 그리고 SaaS 환경의 구조적 특성을 활용하여 내부 시스템에 접근하고 데이터를 탈취한다.
</p>

<ol>
    <li>
        <strong>Apache Struts 2 취약점 악용</strong>
        <p>
            공격자는 SaaS 애플리케이션에서 사용 중인 Apache Struts 2의 RCE 취약점을 악용한다. 
            Content-Type 헤더를 조작한 HTTP 요청을 통해 원격 코드 실행(RCE)을 시도하고, 시스템의 초기 접근 권한을 확보한다.
        </p>
    </li>
    <li>
        <strong>AWS WAF 우회</strong>
        <p>
            공격자는 AWS WAF의 잘못된 보안 규칙을 우회한다. WAF 설정이 특정 URL 패턴이나 헤더만 검증하거나, 
            입력값 검증이 부적절하여 공격자가 악성 요청을 방화벽을 통과시킬 수 있다.
        </p>
    </li>
    <li>
        <strong>AWS EC2 인스턴스 직접 접근</strong>
        <p>
            WAF 우회에 성공한 공격자는 SaaS 애플리케이션이 실행 중인 AWS EC2 인스턴스에 직접 접근한다. 
            Apache Struts 2 취약점을 악용하여 EC2 인스턴스 내부로 침투하고, 백도어를 설치해 지속적인 접근 권한을 확보한다.
        </p>
    </li>
    <li>
        <strong>AWS RDS 데이터 접근 및 조작</strong>
        <p>
            공격자는 AWS RDS에 접근하여 고객 데이터를 대량으로 추출하거나 조작한다. RDS의 네트워크 보안 그룹 설정이 미흡하고, 
            IAM 권한 관리가 부실하여 데이터 접근이 가능하다.
        </p>
    </li>
    <li>
        <strong>고객 데이터 유출 및 외부 전송</strong>
        <p>
            공격자는 탈취한 민감 데이터를 외부 서버로 전송하여 불법 금융 거래, 신원 도용 등의 범죄 활동에 활용한다. 
            이는 금융 회사의 신뢰도와 명성을 크게 훼손시킨다.
        </p>
    </li>
</ol>

<h2>대응책</h2>
<p>
    해당 시나리오를 예방하기 위해 SaaS 기반 금융 AI 시스템의 보안을 강화하는 것이 중요하다.
</p>
<p>
    우선, SaaS 애플리케이션에서 사용되는 모든 오픈소스 라이브러리를 정기적으로 점검해야 한다. 이를 위해 SCA(Software Composition Analysis) 도구를 도입하여 
    Apache Struts 2와 같은 오픈소스 프레임워크의 취약점을 식별하고, 발견된 취약점에 대해 최신 보안 패치를 신속히 적용해야 한다. 
    오픈소스 라이브러리를 사용할 때는 신뢰성을 철저히 검증하고, 필요하지 않은 라이브러리는 제거함으로써 공격 표면을 최소화해야 한다. 
    또한, SaaS 애플리케이션 내에는 이상 탐지 시스템(IDS/IPS)을 설치하여 의심스러운 활동을 지속적으로 모니터링하고, 시스템 침해를 조기에 탐지할 수 있도록 해야 한다.
</p>

<h3>Apache Struts 2 취약점 악용 방지 예시</h3>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyOldLibraries",
      "Effect": "Deny",
      "Action": "ec2:RunInstances",
      "Resource": "*",
      "Condition": {
        "StringNotEqualsIfExists": {
          "aws:RequestedAMI": [
            "ami-validated-struts2" 
          ]
        }
      }
    }
  ]
}
</code>
</pre>
<p>
    AWS WAF(Web Application Firewall) 설정을 강화하는 것도 중요하다. SaaS 애플리케이션에서 발생할 수 있는 주요 취약점에 대한 탐지 규칙을 추가하고, 
    최신 공격 패턴에 따라 WAF 규칙을 정기적으로 업데이트해야 한다. 특히, Whitelist 기반 정책을 적용하여 허용된 IP 주소나 도메인만 접근할 수 있도록 제한함으로써 
    공격 표면을 효과적으로 줄일 수 있다. WAF 로그와 SaaS 애플리케이션 로그를 통합 분석하여 비정상적인 요청을 실시간으로 탐지하고 신속히 대응할 수 있는 체계를 마련해야 한다.
</p>

<h3>AWS WAF 우회 방지 예시</h3>
<pre>
<code>
{
  "WebACL": {
    "Name": "SecureSaaSWebACL",
    "DefaultAction": {
      "Type": "BLOCK"
    },
    "Rules": [
      {
        "Name": "AllowSpecificIPs",
        "Priority": 1,
        "Action": {
          "Type": "ALLOW"
        },
        "Statement": {
          "IPSetReferenceStatement": {
            "ARN": "arn:aws:wafv2:region:account-id:ipset/allowed-ips"
          }
        }
      },
      {
        "Name": "BlockCommonAttacks",
        "Priority": 2,
        "Action": {
          "Type": "BLOCK"
        },
        "Statement": {
          "ManagedRuleGroupStatement": {
            "VendorName": "AWS",
            "Name": "AWSManagedRulesCommonRuleSet"
          }
        }
      }
    ]
  }
}
</code>
</pre>
<p>
    AWS EC2 인스턴스와 RDS(Relational Database Service)의 보안을 강화하는 것도 필수적이다. AWS EC2 인스턴스에서 실행 중인 모든 애플리케이션과 구성 요소에 대해 
    취약점 점검을 정기적으로 수행하고, 최신 보안 패치를 적용하여 시스템의 안전성을 보장해야 한다. 또한, EC2 인스턴스 내부에 설치된 애플리케이션의 네트워크 통신을 
    최소화하고, 필요하지 않은 서비스는 비활성화하여 공격 표면을 줄여야 한다. AWS RDS에서는 저장된 데이터를 AES-256 암호화로 보호하고, 
    최소 권한 접근 원칙을 적용하여 데이터 접근 권한을 최소화해야 한다. 네트워크 보안 그룹 설정을 강화하고, 데이터가 외부로 유출되지 않도록 내부 네트워크를 
    격리하여 보안성을 높여야 한다.
</p>

<h3>AWS EC2 인스턴스 직접 접근 방지 예시</h3>
<p>SSH 및 HTTP 접근을 특정 IP 대역으로 제한하고, 불필요한 포트 접근을 차단하는 설정:</p>
<pre>
<code>
{
  "SecurityGroup": {
    "GroupId": "sg-secure",
    "Description": "Restrict EC2 Access",
    "Ingress": [
      {
        "IpProtocol": "tcp",
        "FromPort": 22,
        "ToPort": 22,
        "CidrIp": "192.0.2.0/24"
      },
      {
        "IpProtocol": "tcp",
        "FromPort": 80,
        "ToPort": 80,
        "CidrIp": "203.0.113.0/24"
      }
    ],
    "Egress": [
      {
        "IpProtocol": "-1",
        "CidrIp": "0.0.0.0/0"
      }
    ]
  }
}
</code>
</pre>

<h3>AWS RDS 데이터 접근 방지 예시</h3>
<p>RDS 암호화를 활성화하고 네트워크 접근을 내부 VPC로 제한하는 설정:</p>
<pre>
<code>
{
  "DBInstance": {
    "DBInstanceIdentifier": "secure-rds-instance",
    "Engine": "mysql",
    "StorageEncrypted": true,
    "BackupRetentionPeriod": 7,
    "PubliclyAccessible": false,
    "VpcSecurityGroupIds": [
      "sg-secure"
    ]
  }
}
</code>
</pre>

<h3>고객 데이터 유출 방지 예시</h3>
<p>VPC 흐름 로그를 활성화하여 외부로의 데이터 유출을 탐지하는 설정:</p>
<pre>
<code>
{
  "FlowLogs": {
    "ResourceId": "vpc-secure",
    "ResourceType": "VPC",
    "TrafficType": "ALL",
    "LogDestinationType": "cloud-watch-logs",
    "LogFormat": "${version} ${srcaddr} ${dstaddr} ${protocol} ${srcport} ${dstport} ${action} ${bytes} ${packets}"
  }
}
</code>
</pre>

<p>
    마지막으로, SaaS 운영자와 개발자를 대상으로 정기적인 보안 교육을 실시해야 한다. 교육을 통해 오픈소스 라이브러리 사용과 SaaS 환경에서 발생할 수 있는 보안 위험 및 
    대응 방안을 숙지시켜야 한다. 정기적인 보안 점검과 로그 분석을 통해 SaaS 클라우드 환경 전반의 보안 상태를 지속적으로 점검하고 유지하는 것도 중요하다.
</p>
<h1>6. Insecure Software Development</h1>

<h2>취약 시나리오 배경</h2>
<p>
    금융 회사는 고객의 신용 데이터를 분석하고 대출 승인을 자동화하는 금융 AI 시스템을 SaaS 환경에서 구축한다. 
    이 시스템은 AWS 기반 클라우드에서 실행되며, 사용자 편의를 위한 파일 다운로드 기능을 제공한다. 
    그러나 개발 과정에서 파일 경로를 검증하지 않는 코딩 실수가 발생하여 디렉토리 트래버설 취약점이 존재하게 된다. 
    이로 인해 공격자는 악의적인 요청(<code>/download?file=../../config.json</code>)을 전송하여 AWS EC2 인스턴스의 민감한 설정 파일(<code>config.json</code>)에 접근할 수 있다. 
    해당 설정 파일에는 AWS RDS 데이터베이스의 인증 정보가 포함되어 있었으며, 이를 통해 공격자는 데이터베이스에 접근하여 고객 신용 정보와 거래 내역과 같은 민감한 데이터를 탈취한다.
</p>
<p>
    AWS WAF는 기본적인 웹 공격을 방어하기 위해 배치되었으나, 디렉토리 트래버설과 같은 논리적 취약점을 탐지하거나 방어하지 못한다. 
    공격자는 이를 우회하여 금융 AI 시스템이 실행 중인 EC2 인스턴스 내부로 접근할 수 있었고, 이후 백도어를 설치하여 지속적인 접근 권한을 확보한다. 
    이를 바탕으로 RDS 데이터베이스에 저장된 민감한 데이터를 추출하거나 조작하였고, 최종적으로 유출된 데이터를 외부 서버로 전송하여 
    불법 금융 거래와 신원 도용 등의 범죄 활동에 활용한다.
</p>

<img src="https://wikidocs.net/images/page/267442/Insecure_Software_Development_%E1%84%89%E1%85%B5%E1%84%82%E1%85%A1%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A9_%E1%84%8B%E1%85%A1%E1%84%8F%E1%85%B5%E1%84%90%E1%85%A6%E1%86%A8%E1%84%8E%E1%85%A5_%E1%84%80%E1%85%AE%E1%84%89%E1%85%A5%E1%86%BC%E1%84%83%E1%85%A9.png">

<p>
    해당 아키텍처는 WAF, EC2, RDS, VPC와 같은 주요 서비스를 포함한다. WAF는 기본적인 웹 공격 방어를 제공하지만 논리적 취약점 방어에는 한계가 있다. 
    EC2는 금융 AI 시스템이 실행되는 환경을 제공하며, 애플리케이션의 취약점이 발생한 지점이다. RDS는 고객의 민감한 정보를 저장하는 데이터베이스로, 
    공격자가 설정 파일을 통해 인증 정보를 확보하여 접근한다. VPC는 모든 리소스를 외부 위협으로부터 격리하는 역할을 하지만, 애플리케이션 내부의 취약점을 방어하지는 못한다. 
    이러한 환경에서 발생한 취약점은 공격자가 민감한 데이터에 접근하고 유출할 수 있는 주요 원인이 된다.
</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/Insecure_Software_Development_%E1%84%89%E1%85%B5%E1%84%82%E1%85%A1%E1%84%85%E1%85%B5%E1%84%8B%E1%85%A9_%E1%84%80%E1%85%AE%E1%84%89%E1%85%A1%E1%86%BC%E1%84%83%E1%85%A9.png" >

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <strong>디렉토리 트래버설 취약점 악용</strong>
        <p>
            공격자는 SaaS 애플리케이션의 파일 다운로드 기능에서 발생한 디렉토리 트래버설 취약점을 악용한다. 
            개발자의 코딩 실수로 인해 파일 다운로드 요청 경로에 대한 검증이 제대로 이루어지지 않았고, 
            공격자는 악의적으로 조작된 HTTP 요청(<code>/download?file=../../config.json</code>)을 전송하여 
            금융 AI 애플리케이션이 실행 중인 EC2 인스턴스의 민감한 환경 설정 파일(<code>config.json</code>)을 다운로드한다. 
            해당 파일에는 데이터베이스 인증 정보와 기타 민감한 설정이 포함되어 있다.
        </p>
    </li>
    <li>
        <strong>AWS WAF 우회</strong>
        <p>
            AWS WAF(Web Application Firewall)는 기본적으로 일반적인 공격 패턴을 방어하지만, 
            애플리케이션 레벨에서 발생하는 논리적 취약점(디렉토리 트래버설)까지 방어하지는 못한다. 
            결과적으로 공격 요청은 WAF를 우회하여 EC2 인스턴스의 파일 다운로드 기능에 도달한다.
        </p>
    </li>
    <li>
        <strong>AWS EC2 접근 및 내부 침투</strong>
        <p>
            공격자는 환경 설정 파일(<code>config.json</code>)에서 확보한 데이터베이스 연결 정보와 애플리케이션 구성 정보를 활용하여 EC2 인스턴스 내부에 침투한다. 
            이를 통해 금융 AI 시스템의 구성 요소를 탐색하고, 백도어를 설치하여 지속적인 접근 권한을 확보한다. 
            이러한 권한을 통해 추가적인 시스템 자원 및 데이터를 공격자가 활용할 수 있는 상태가 된다.
        </p>
    </li>
    <li>
        <strong>AWS RDS 데이터 접근 및 조작</strong>
        <p>
            공격자는 확보한 인증 정보를 사용하여 AWS RDS 데이터베이스에 접근한다. 데이터베이스에는 고객의 신용 정보, 대출 내역, 거래 내역과 같은 
            민감한 정보가 저장되어 있다. 네트워크 보안 그룹 설정이 미흡하거나 데이터 암호화가 적용되지 않은 경우, 공격자는 데이터를 탈취하거나 조작한다.
        </p>
    </li>
    <li>
        <strong>데이터 유출 및 외부 서버 전송</strong>
        <p>
            탈취한 민감한 데이터는 공격자의 외부 서버로 전송된다. 공격자는 이를 통해 불법 금융 거래, 신원 도용, 사기 등의 범죄 활동에 데이터를 활용할 수 있다. 
            이로 인해 금융 회사는 고객 신뢰도와 명성을 크게 잃고, 법적 책임과 재정적 손실을 입게 된다.
        </p>
    </li>
</ol>

<h2>대응책</h2>
<p>
    SaaS 애플리케이션의 보안 강화를 위해 파일 다운로드 기능과 AWS 환경 설정을 철저히 검증해야 한다. 
    파일 다운로드 기능에서는 전달받는 경로를 엄격히 검증하고, 화이트리스트 기반의 파일 경로 검증을 통해 허용된 파일만 다운로드할 수 있도록 설정해야 한다. 
    또한, 입력된 값을 정규화하여 의도치 않은 경로 접근을 차단함으로써 디렉토리 트래버설 취약점을 방지해야 한다.
</p>

<h3>파일 다운로드 경로 검증 예시</h3>
<p>AWS Lambda를 활용하여 파일 경로를 검증하는 설정:</p>
<pre>
<code>
{
  "FunctionName": "ValidateDownloadPath",
  "Runtime": "python3.x",
  "Role": "arn:aws:iam::123456789012:role/lambda-basic-execution",
  "Handler": "lambda_function.lambda_handler",
  "Code": {
    "ZipFile": "def lambda_handler(event, context):\n  allowed_files = ['file1.txt', 'file2.json']\n  requested_file = event['queryStringParameters']['file']\n  if requested_file in allowed_files:\n    return {'statusCode': 200, 'body': 'File access granted'}\n  else:\n    return {'statusCode': 403, 'body': 'Access denied'}"
  }
}
</code>
</pre>
<h3>AWS WAF 규칙 강화 예시</h3>
<p>AWS WAF에서 사용자 정의 규칙을 설정하여 디렉토리 트래버설 공격 패턴을 차단하는 설정:</p>
<pre>
<code>
{
  "Name": "BlockDirectoryTraversal",
  "Scope": "REGIONAL",
  "DefaultAction": { "Allow": {} },
  "Rules": [
    {
      "Name": "DirectoryTraversalRule",
      "Priority": 1,
      "Statement": {
        "ByteMatchStatement": {
          "SearchString": "../",
          "FieldToMatch": { "QueryString": {} },
          "TextTransformations": [{ "Type": "NONE", "Priority": 0 }]
        }
      },
      "Action": { "Block": {} }
    }
  ],
  "VisibilityConfig": {
    "SampledRequestsEnabled": true,
    "CloudWatchMetricsEnabled": true,
    "MetricName": "DirectoryTraversalMetric"
  }
}
</code>
</pre>

<h3>EC2 인스턴스 보안 강화 예시</h3>
<p>민감한 파일에 대한 접근 권한을 제한하고, SSH 접근을 최소화하며, 신뢰할 수 있는 IP만 접근을 허용하는 보안 그룹 설정:</p>
<pre>
<code>
{
  "GroupName": "SecureEC2Access",
  "Description": "Allow only trusted IPs",
  "IpPermissions": [
    {
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "IpRanges": [
        { "CidrIp": "203.0.113.0/24", "Description": "Trusted Office Network" }
      ]
    }
  ]
}
</code>
</pre>

<h3>AWS RDS 보안 강화 예시</h3>
<p>RDS 데이터 암호화 및 IAM 정책을 활용하여 보안을 강화하는 설정:</p>
<pre>
<code>
{
  "DBInstanceIdentifier": "secure-rds-instance",
  "AllocatedStorage": 20,
  "DBInstanceClass": "db.t3.medium",
  "Engine": "mysql",
  "MasterUsername": "admin",
  "MasterUserPassword": "securepassword123",
  "StorageEncrypted": true,
  "KmsKeyId": "arn:aws:kms:region:123456789012:key/key-id"
}
</code>
</pre>

<p>IAM 정책 설정 예시:</p>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "rds:Connect",
      "Resource": "arn:aws:rds:region:123456789012:db:secure-rds-instance",
      "Condition": {
        "StringEquals": { "aws:username": "trusted-user" }
      }
    }
  ]
}
</code>
</pre>

<h3>외부 데이터 전송 모니터링</h3>
<p>VPC 플로우 로그를 활성화하여 외부로의 데이터 전송을 모니터링하고, 비인가된 전송을 탐지하는 설정:</p>
<pre>
<code>
{
  "LogGroupName": "VPCFlowLogs",
  "ResourceId": "vpc-0123456789abcdef",
  "ResourceType": "VPC",
  "TrafficType": "ALL",
  "LogDestinationType": "cloud-watch-logs",
  "LogDestination": "arn:aws:logs:region:123456789012:log-group:VPCFlowLogs"
}
</code>
</pre>

<p>
    마지막으로, 개발자와 운영자를 대상으로 정기적인 보안 교육을 실시하여 코딩 실수로 인해 발생할 수 있는 취약점을 인식하도록 해야 한다. 
    보안 코드 리뷰를 정기적으로 수행하여 개발 단계에서 취약점을 조기에 발견하고 수정함으로써 보안을 강화해야 한다.
</p>
<h1>7. Accidental Cloud Disclosure</h1>

<h2>취약 시나리오 배경</h2>
<img src="https://wikidocs.net/images/page/267442/image_12.png">

<p>
    AWS를 기반으로 금융 서비스를 제공하는 한 기관은 고객의 대출 기록, 거래 내역, 투자 성향 등 민감 데이터를 활용하여 생성형 AI 기반 금융 추천 서비스를 챗봇 형태로 운영하고 있다. 
    사용자가 금융 관련 질문을 챗봇 인터페이스에 입력하면 해당 요청이 Amazon API Gateway로 전달되고 이후 AWS Lambda로 전달된다. 
    AWS Lambda는 요청을 분석하고 Amazon S3에서 필요한 데이터를 조회하며 사용자 쿼리와 관련 데이터를 OpenAI API에 전달한다. 
    이 과정은 DynamoDB에 실시간으로 기록되고 AWS Lambda는 최종적으로 OpenAI API에서 생성된 응답을 API Gateway를 통해 사용자에게 전달하며 서비스가 운영된다.
</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/image_13.png">

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <strong>공개된 엔드포인트 탐색</strong>
        <p>
            해커는 공개적으로 접근 가능한 엔드포인트(API Gateway, Lambda 등)를 스캔한다. Nmap, Shodan 등 스캐닝 도구를 사용하여 노출된 엔드포인트와 
            취약점을 탐색하며, 인증 없이 접근할 수 있는 URL이나 잘못된 보안 설정(CORS 설정 오작동, IAM 정책 오용 등)을 발견한다.
        </p>
    </li>
    <li>
        <strong>취약점 발견</strong>
        <p>
            해커는 Amazon API Gateway와 AWS Lambda에 인증 없이 요청을 처리할 수 있는 엔드포인트, Public으로 설정된 S3 버킷, 과도한 IAM 역할 권한 등 
            취약점을 발견한다. AWS 액세스 키가 코드 저장소나 로그 파일에 노출된 경우도 포함된다.
        </p>
    </li>
    <li>
        <strong>악의적인 요청 전송</strong>
        <p>
            해커는 발견된 취약점을 악용하여 Amazon API Gateway를 통해 비인가 API 호출을 수행하고 AWS Lambda 함수를 실행하여 S3 또는 DynamoDB의 데이터를 
            조회하거나 다운로드한다.
        </p>
    </li>
    <li>
        <strong>S3 데이터 탈취</strong>
        <p>
            Public 설정된 S3 버킷에서 고객 대출 기록, 투자 성향 등의 개인정보와 서비스 로그 파일을 다운로드한다.
        </p>
    </li>
    <li>
        <strong>DynamoDB 데이터 탈취</strong>
        <p>
            IAM 권한을 악용하여 DynamoDB 테이블에 접근하고 사용자 요청 기록과 응답 데이터, 거래 내역 등의 민감 데이터를 탈취한다.
        </p>
    </li>
    <li>
        <strong>데이터 변조</strong>
        <p>
            해커는 DynamoDB의 데이터를 조작하거나 S3 학습 데이터를 변조하여 OpenAI API 출력 결과를 왜곡한다.
        </p>
    </li>
    <li>
        <strong>서비스 장애 발생</strong>
        <p>
            DynamoDB 데이터 조작과 AI 모델 오작동이 결합되어 금융 서비스가 중단되며 고객 신뢰도와 회사 명성이 하락한다.
        </p>
    </li>
</ol>

<h2>대응책</h2>
<p>
    해커가 공개된 엔드포인트를 탐색하지 못하도록 AWS WAF를 설정하고, IP 블랙리스트와 Geo-restriction을 통해 악성 트래픽을 차단해야 한다.
</p>
<pre>
<code>
{
  "WAFConfiguration": {
    "Rules": [
      {
        "Name": "IPBlacklist",
        "Action": "BLOCK",
        "IPSet": ["192.168.0.1/32", "10.0.0.0/16"]
      },
      {
        "Name": "GeoRestriction",
        "Action": "BLOCK",
        "CountryCodes": ["CN", "RU"]
      }
    ]
  }
}
</code>
</pre>
<p>
    Lambda와 API Gateway는 Private VPC에 배치하고, 모든 엔드포인트에 인증 체계를 적용해야 한다. 불필요한 엔드포인트는 비활성화해야 한다.
</p>
<pre>
<code>
{
  "APIGatewayEndpoint": {
    "VPCLink": "PrivateVPC",
    "Authentication": "Enabled",
    "UnusedEndpoints": "Disabled"
  }
}
</code>
</pre>
<p>
    Lambda 함수의 입력값은 항상 Validation을 통해 검증하고, S3 버킷은 Public Access Block 설정으로 외부 접근을 차단해야 한다.
</p>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "DenyPublicAccess",
      "Effect": "Deny",
      "Principal": "*",
      "Action": "s3:*",
      "Resource": [
        "arn:aws:s3:::my-secure-bucket",
        "arn:aws:s3:::my-secure-bucket/*"
      ],
      "Condition": {
        "Bool": {
          "aws:SecureTransport": false
        }
      }
    }
  ]
}
</code>
</pre>
<p>
    IAM 정책은 최소 권한 원칙에 따라 주기적으로 검토하고, CloudTrail로 권한 사용 내역을 모니터링해야 한다.
</p>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "AllowDynamoDBRead",
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:Query",
        "dynamodb:Scan"
      ],
      "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/MyDynamoDBTable"
    },
    {
      "Sid": "AllowS3Access",
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-secure-bucket/*"
    },
    {
      "Sid": "DenyAllOtherActions",
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*"
    }
  ]
}
</code>
</pre>

<p>
    S3 데이터는 암호화(SSE 또는 KMS)를 적용하고, AWS Secrets Manager를 통해 AWS 키를 안전하게 관리해야 한다. DynamoDB는 특정 리소스만 접근 가능하도록 제한하고, 
    DynamoDB Streams와 CloudWatch로 비정상적인 활동을 모니터링해야 한다.
</p>
<pre>
<code>
{
  "TrailName": "SecurityTrail",
  "S3BucketName": "my-cloudtrail-logs",
  "IncludeGlobalServiceEvents": true,
  "IsMultiRegionTrail": true,
  "EnableLogFileValidation": true,
  "IsOrganizationTrail": false,
  "EventSelectors": [
    {
      "ReadWriteType": "All",
      "IncludeManagementEvents": true,
      "DataResources": [
        {
          "Type": "AWS::S3::Object",
          "Values": ["arn:aws:s3:::my-secure-bucket/"]
        },
        {
          "Type": "AWS::DynamoDB::Table",
          "Values": ["arn:aws:dynamodb:us-east-1:123456789012:table/MyDynamoDBTable"]
        }
      ]
    }
  ]
}
</code>
</pre>

<p>
    데이터 무결성을 보장하기 위해 S3 데이터에 Checksum 검증을 적용하고, DynamoDB 테이블의 쓰기 권한을 최소화해야 한다. 또한 CloudTrail과 GuardDuty를 활용해 
    비정상적인 접근을 탐지하고 차단해야 한다.
</p>
<pre>
<code>
{
  "DetectorId": "12abc34d567e8f901g2h345i6789jk01",
  "Enable": true,
  "FindingPublishingFrequency": "FIFTEEN_MINUTES"
}
</code>
</pre>
<p>
    이러한 조치를 통해 민감 데이터 보호를 강화하고 클라우드 환경에서 발생할 수 있는 데이터 유출 사고를 예방할 수 있다.
</p>
<h1>8. System Vulnerabilities</h1>

<h2>취약 시나리오 배경</h2>
<p>
    시스템 취약점은 클라우드 서비스 구성이나 내부 시스템의 설계 및 운영상의 약점으로 인해 발생한다. 이는 잘못된 권한 관리, 취약한 네트워크 구성, 인증 및 입력 검증 부족 등의 형태로 나타날 수 있다. 
    SaaS 환경에서는 이러한 취약점을 통해 공격자가 민감 데이터를 유출하거나 시스템에 악성 명령을 실행할 수 있다. 
    특히 금융권에서는 민감 정보와 관련된 데이터 보호가 필수적이므로, 시스템 취약점이 발생하면 고객 정보 유출, 서비스 중단, 법적 책임 등의 심각한 결과를 초래할 수 있다. 
    이러한 취약점을 사전에 식별하고 방어 체계를 강화하는 것이 중요하다.
</p>

<img src="https://wikidocs.net/images/page/267442/image_14.png">
<p>System Vulnerabilities Architecture</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/image_15.png">

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <strong>초기 접근</strong>
        <p>
            공격자는 EC2 인스턴스의 공개된 IP 주소를 탐지하고, Nmap 도구를 사용해 열려 있는 포트를 스캔하며 서비스 정보를 수집한다. 
            SSH(22번 포트)와 웹 서비스(80번 포트)가 열려 있고, OS가 Ubuntu 20.04임을 확인한 후, OpenSSH의 알려진 취약점을 악용하여 
            사용자 계정을 추출하고 브루트 포스 공격으로 루트 계정("root1234")에 접근한다.
        </p>
    </li>
    <li>
        <strong>초기 침투</strong>
        <p>
            루트 계정 접근 권한을 확보한 공격자는 EC2에서 실행 중인 OpenAI API 연동 애플리케이션의 설정 파일과 로그 파일을 탐색하여 
            평문으로 저장된 OpenAI API 키를 발견한다. 이를 통해 비인가 요청을 수행하거나 AWS 서비스 접근 권한을 테스트한다.
        </p>
    </li>
    <li>
        <strong>권한 상승</strong>
        <p>
            공격자는 IAM 역할을 통해 S3와 RDS 접근 권한을 확인하고, AWS CLI를 이용해 금융 데이터를 포함한 S3 버킷 목록을 열람하며, 
            민감 데이터를 조회한다.
        </p>
    </li>
    <li>
        <strong>내부 탐색 및 지속성 확보</strong>
        <p>
            공격자는 EC2 환경 변수에서 AWS Access Key와 Secret Key를 확보한 후, 외부 AWS API 호출을 통해 추가 리소스 접근 권한을 얻는다. 
            또한 SSH 설정 파일을 수정하여 백도어 계정을 추가하고, Reverse Shell을 설정해 지속적인 접근을 확보한다.
        </p>
    </li>
    <li>
        <strong>데이터 탈취</strong>
        <p>
            공격자는 OpenAI API 응답 데이터, S3 버킷의 금융 데이터, RDS 데이터베이스의 고객 정보를 탈취하여 
            공격자 서버로 전송한다. 탈취된 데이터는 추가 공격 또는 금전적 이득을 위해 활용된다.
        </p>
    </li>
</ol>

<h2>대응책</h2>
<h3>1. EC2 인스턴스 보안 강화</h3>
<pre>
<code>
{
  "Description": "SSH 보안 그룹 설정",
  "SecurityGroupRules": [
    {
      "IpProtocol": "tcp",
      "FromPort": 22,
      "ToPort": 22,
      "CidrIp": "203.0.113.0/32", 
      "Description": "SSH 접속 허용 (특정 IP만)"
    }
  ]
}
</code>
</pre>
<p>SSH 접속을 제한하고, 비밀번호 인증 대신 SSH 키 페어 인증만 허용해야 한다.</p>

<h3>2. IAM 역할 및 정책 관리</h3>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::my-secure-bucket",
        "arn:aws:s3:::my-secure-bucket/*"
      ],
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "203.0.113.0/32"
        }
      }
    }
  ]
}
</code>
</pre>
<p>IAM 정책을 최소 권한 원칙에 따라 설정하고, CloudTrail을 활용해 권한 사용 내역을 모니터링해야 한다.</p>

<h3>3. OpenAI API 키 관리</h3>
<pre>
<code>
{
  "APIKeyManagement": {
    "EnvironmentVariable": "OPENAI_API_KEY",
    "RotationPolicy": "Every 30 days",
    "Encryption": "Enabled"
  }
}
</code>
</pre>
<p>API 키는 환경 변수 또는 암호화된 저장소에서 관리하며, 주기적으로 교체하고 사용하지 않는 키는 폐기해야 한다.</p>

<h3>4. 데이터 암호화 및 네트워크 보안</h3>
<pre>
<code>
{
  "S3BucketEncryption": {
    "BucketName": "my-secure-bucket",
    "Encryption": "AES256"
  },
  "RDSInstanceEncryption": {
    "InstanceIdentifier": "my-rds-instance",
    "StorageEncrypted": true,
    "SSLConnection": true
  }
}
</code>
</pre>
<p>S3와 RDS 데이터를 암호화하고, SSL/TLS를 적용해 데이터 전송을 보호해야 한다.</p>

<h3>5. 모니터링 및 이상 탐지</h3>
<pre>
<code>
{
  "TrailName": "SecurityTrail",
  "S3BucketName": "my-cloudtrail-logs",
  "IncludeGlobalServiceEvents": true,
  "IsMultiRegionTrail": true,
  "EnableLogFileValidation": true
}
</code>
</pre>
<p>CloudTrail, GuardDuty를 통해 실시간 이상 활동을 탐지하고, 침해 대응 계획을 수립해야 한다.</p>


 <h1>9. Limited Cloud Visibility / Observability</h1>

<h2>취약 시나리오 배경</h2>

<h3>아키텍처 설명</h3>
<img src="https://wikidocs.net/images/page/267442/9_wfiBAC0.png" alt="Sample Image" />

<p>

금융기관은 AWS 서버리스 아키텍처를 활용하여 챗GPT 기반 고객 상담 서비스를 제공한다. 고객이 웹 또는 모바일 클라이언트를 통해 요청을 보내면, API Gateway가 이를 수신하고 AWS Lambda 함수로 전달한다. Lambda 함수는 챗GPT API를 호출하여 생성된 응답 데이터를 S3 버킷에 저장한다.

이 아키텍처는 SaaS 형태의 생성형 AI 서비스를 제공하며 사용자 요청을 처리하고 결과를 저장하는 흐름을 나타낸다. 사용자는 웹 또는 모바일 애플리케이션을 통해 콘텐츠 생성 요청을 보내며, 이 요청은 HTTP 프로토콜을 사용하여 서버로 전달된다. API Gateway는 사용자 요청을 수신하고 이를 AWS Lambda로 전달하며, 요청 유효성을 검증하고 올바른 Lambda 함수와 통신하도록 라우팅을 설정한다. 이 과정에서 인증 및 권한 검사가 수행될 수 있다. AWS Lambda는 서버리스 컴퓨팅 리소스로 사용자 요청을 처리하는 비즈니스 로직을 실행하며, SaaS AI API(OpenAI ChatGPT 등)를 호출하여 사용자 요청에 대한 결과를 생성한다. SaaS AI 서비스는 사용자의 요청에 따라 콘텐츠를 생성하고 적절한 응답을 반환한다. 생성된 콘텐츠와 관련된 메타데이터 또는 상태 정보는 DynamoDB에 저장되며, 예를 들어 요청의 고유 ID, 생성된 콘텐츠의 상태, 생성 시각 등이 포함된다. 생성된 콘텐츠 자체는 S3에 저장되어 사용자가 나중에 접근할 수 있도록 보관된다.

SaaS AI API와 통신하는 Lambda 함수의 호출 내역 및 오류 로그가 CloudWatch Logs에 저장되지 않고 있다. CloudTrail 설정이 누락되어 접근 기록을 확인할 수 없다. SaaS AI API 호출 제한을 초과했지만 서비스 대시보드에서 이 정보에 대한 경고를 확인하지 못한다. </p>
</ul>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/9.1.png" alt="Example Image" />

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <strong>CloudTrail 로그를 저장하는 S3 버킷 식별</strong>
        <p><strong>공격자 활동:</strong></p>
        <ul>
            <li>공격자는 클라우드 설정을 분석하여 <strong>CloudTrail 로그를 저장하는 S3 버킷</strong>의 이름과 접근 가능성을 식별.</li>
            <li>S3 버킷 탐색 도구( AWS S3Scanner 또는 버킷 URL 추측)를 통해 대상 버킷을 탐색.</li>
            <li>잘못된 S3 버킷 정책으로 인해 <strong>ListObjects</strong> 권한이 활성화된 경우 파일 목록 확인 가능:</li>
        </ul>
        <pre>
<code>
aws s3 ls s3://cloudtrail-logs-bucket/
</code>
        </pre>
    </li>
    <li>
        <strong>로그의 API 호출 기록 분석</strong>
        <p><strong>공격자 활동:</strong></p>
        <ul>
            <li>S3 버킷에서 CloudTrail 로그 파일을 다운로드:</li>
        </ul>
        <pre>
<code>
aws s3 cp s3://cloudtrail-logs-bucket/2024/11/17/1234567890_CloudTrail.json .
</code>
        </pre>
        <ul>
            <li>다운로드한 로그 파일을 열어 주요 API 호출 기록을 분석:
                <ul>
                    <li>Lambda 함수 이름.</li>
                    <li>DynamoDB 테이블 이름.</li>
                    <li>SaaS API 엔드포인트.</li>
                </ul>
            </li>
            <li>공격자는 <strong>Lambda 함수 호출 패턴</strong>과 <strong>API 구조</strong>를 이해하여 다음 단계를 준비.</li>
        </ul>
    </li>
    <li>
        <strong>Lambda 통한 API 남용</strong>
        <p><strong>공격자 활동:</strong></p>
        <ul>
            <li>분석 결과를 토대로 Lambda 함수가 특정 API 엔드포인트를 호출하는 데 사용된다는 사실을 파악.</li>
            <li>AWS CLI 또는 SDK를 통해 Lambda 함수 호출:</li>
        </ul>
        <pre>
<code>
aws lambda invoke --function-name processCustomerRequest --payload '{"action":"generateReport"}' response.json
</code>
        </pre>
        <ul>
            <li><strong>결과:</strong> SaaS API의 남용을 통해 서비스 한도를 초과. 정상 사용자 요청 처리 실패.</li>
        </ul>
    </li>
    <li>
        <strong>CloudTrail 로그 삭제</strong>
        <p><strong>공격자 활동:</strong></p>
        <ul>
            <li>자신의 활동을 은폐하기 위해 CloudTrail 로그 삭제 시도.</li>
            <li><strong>S3 버킷의 DeleteObject 권한</strong>을 이용하여 로그 삭제:</li>
        </ul>
        <pre>
<code>
aws s3 rm s3://cloudtrail-logs-bucket/2024/11/17/1234567890_CloudTrail.json
</code>
        </pre>
        <ul>
            <li><strong>CloudTrail 서비스 비활성화:</strong></li>
        </ul>
        <pre>
<code>
aws cloudtrail stop-logging --name CloudTrailName
</code>
        </pre>
    </li>
    <li>
        <strong>로그 미흡으로 인한 식별 불가</strong>
        <ul>
            <li><strong>결과:</strong> CloudTrail 로그 삭제로 인해 API 남용과 데이터 유출에 대한 정확한 타임라인 확인 불가.</li>
            <li>보안 팀은 문제를 식별하는 데 더 많은 시간이 필요.</li>
            <li>피해: SaaS 서비스의 신뢰도 하락, 금전적 손실, 고객 데이터 유출.</li>
        </ul>
    </li>
</ol>

<h2>대응책</h2>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "s3:DeleteObject",
      "Resource": "arn:aws:s3:::cloudtrail-logs-bucket/*"
    }
  ]
}
</code>
</pre>
<p>S3 버킷 보안을 강화하기 위해 <strong>Public Access Block</strong>을 활성화하고 IAM 정책을 통해 삭제 및 수정 권한을 최소화해야 한다.</p>

<pre>
<code>
AlarmName: "CloudTrailLogDeleteAlarm"
MetricName: "NumberOfObjectsDeleted"
Namespace: "AWS/S3"
Statistic: "Sum"
Period: 300
EvaluationPeriods: 1
Threshold: 1
ComparisonOperator: "GreaterThanOrEqualToThreshold"
AlarmActions:
  - arn:aws:sns:region:account-id:alert-topic
</code>
</pre>
<p>CloudTrail 로그의 무결성을 보장하기 위해 AWS KMS를 활용해 로그를 암호화하고, S3 버킷에 버전 관리를 활성화해야 한다.</p>

<pre>
<code>
export OPENAI_API_KEY="your_secure_key"
</code>
</pre>
<p>민감한 API 키는 환경 변수나 암호화된 저장소에서 관리해야 하며, 주요 자산에 대한 보안을 강화해야 한다.</p>
<h1>10. Unauthenticated Resource Sharing (가은)</h1>

<h2>취약 시나리오 배경</h2>
<img src="https://wikidocs.net/images/page/267442/image_18.png">

<h3>시스템 개요</h3>
<p>금융기관이 챗GPT 기반 고객 상담 서비스를 제공하기 위해 AWS 서버리스 아키텍처를 활용</p>

<h3>서비스 흐름</h3>
<p>
    고객이 웹 또는 모바일 클라이언트를 통해 챗GPT 서비스에 요청을 보내면, API Gateway가 요청을 수신하여 AWS Lambda 함수로 전달한다. 
    Lambda는 챗GPT API를 호출하고, 응답 데이터를 S3 버킷에 저장한다.
</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/image_19.png">

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <strong>1단계: 정보 수집 (Reconnaissance)</strong>
        <p>
            공격자는 인터넷에서 퍼블릭하게 노출된 AWS S3 버킷을 검색.
            S3 버킷 이름이 직관적(<code>chatgpt-user-data</code>)이거나 URL이 외부에 유출된 것을 탐지.
        </p>
        <p><strong>도구 사용:</strong> GrayHatWarfare 또는 AWS S3Scanner와 같은 자동화 도구를 사용하여 S3 버킷의 노출 여부를 확인.</p>
    </li>
    <li>
        <strong>2단계: S3 버킷 액세스 권한 확인</strong>
        <p>공격자는 S3 버킷에 "ListObjects" 권한이 활성화된 것을 발견.</p>
        <p>이를 통해 버킷 내부의 파일 목록을 확인:</p>
        <pre>
<code>
/2024/11/17/customer-query-log-001.json
/2024/11/17/chatbot-response-log-001.json
</code>
        </pre>
    </li>
    <li>
        <strong>3단계: 데이터 다운로드</strong>
        <p>공격자는 "GetObject" 권한도 활성화되어 있음을 확인하고, 다음 명령어로 데이터를 다운로드:</p>
        <pre>
<code>
aws s3 cp s3://chatgpt-user-data/2024/11/17/customer-query-log-001.json .
aws s3 cp s3://chatgpt-user-data/2024/11/17/chatbot-response-log-001.json .
</code>
        </pre>
        <p>다운로드된 파일에는 고객 질문과 챗봇 응답 데이터가 포함되어 있음:</p>
        <pre>
<code>
{
  "customer_id": "12345",
  "query": "내 대출 상환 계획을 확인해줘.",
  "response": "2024년 12월까지 매월 50만 원을 상환해야 합니다."
}
</code>
        </pre>
    </li>
    <li>
        <strong>4단계: 민감 데이터 악용</strong>
        <p>공격자는 탈취한 데이터를 분석하여 개인 정보와 금융 데이터를 식별.</p>
        <p>이를 기반으로 피싱 이메일 발송, 개인 정보 도용, 신용 정보 조작 등의 2차 공격을 시도.</p>
    </li>
</ol>

<h2>대응책</h2>
<pre>
<code>
aws s3api put-public-access-block --bucket chatgpt-user-data --public-access-block-configuration '{
  "BlockPublicAcls": true,
  "IgnorePublicAcls": true,
  "BlockPublicPolicy": true,
  "RestrictPublicBuckets": true
}'
</code>
</pre>
<p>
    S3 버킷의 보안을 강화하기 위해 <strong>Public Access Block</strong>을 활성화하고 모든 S3 객체에 암호화를 적용해야 한다. 
    특히 SSE-KMS(Key Management Service)를 사용하여 데이터 암호화를 설정하면 안전성을 크게 높일 수 있다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::chatgpt-user-data/*"
    }
  ]
}
</code>
</pre>
<p>
    API Gateway의 경우 인증 및 권한 관리를 강화하기 위해 IAM 인증 또는 Amazon Cognito 기반 인증을 요구해야 한다. 
    민감한 데이터 접근은 역할(Role) 기반 권한 제어를 통해 세분화하여 최소 권한 원칙을 준수해야 한다.
</p>

<pre>
<code>
export OPENAI_API_KEY="your_secure_key"
</code>
</pre>
<p>
    민감한 데이터 접근을 모니터링하고 이상 탐지를 위해 AWS CloudTrail을 활용해 S3 접근 로그를 활성화하며, 
    GuardDuty를 사용하여 비정상적인 접근 시도를 탐지해야 한다.
</p>

<p>
    모니터링 및 검증을 위해 OWASP ZAP과 같은 도구를 사용해 S3 버킷의 퍼블릭 액세스 여부를 주기적으로 점검하고, 
    모의 침투 테스트를 통해 실제 공격 시나리오를 재현하여 대응 방안을 검증해야 한다.
</p>

<p>
    마지막으로, 사고 대응 프로세스를 명확히 구축하고, 데이터 유출 사고 발생 시 접근 권한 제거 및 고객 알림 등 신속한 대응 절차를 마련해야 한다.
</p>
<h1>11. Advanced Persistent Threats</h1>

<h2>취약 시나리오 배경</h2>
<img src="https://wikidocs.net/images/page/267442/image_20.png">

<p>
금융사가 고객 맞춤 추천 서비스를 제공하고 있다. 고객이 앱/웹을 통해 활동하며 발생하는 데이터를 Amazon Kinesis가 실시간으로 수집하고 분석한다. 
해당 데이터는 AWS EC2로 전달되어 프로모션을 생성하거나 관리한다. 고객 정보들을 OpenAI API로 전달하여 개인 맞춤형 추천 결과를 생성한다. 
결과 데이터는 S3와 Amazon DynamoDB와 DAX(DynamoDB Accelerator) 같은 데이터베이스로 전달된다. 이후 Amazon Athena가 데이터 분석을 수행하며 Amazon QuickSight에서 데이터를 시각화하여 
캠페인 효과 대시보드를 생성하고 Amazon Pinpoint를 통해 이메일, SMS, 또는 푸시 알림 발송 등 마케팅 활동을 실행하는 과정으로 서비스가 동작한다.
</p>

<h2>시나리오 구상도</h2>
<img src="https://wikidocs.net/images/page/267442/image_21.png">

<h2>공격/유출 과정 설명</h2>
<ol>
    <li>
        <h3>1. 공개된 엔드포인트 탐색</h3>
        <p>
            해커는 시스템의 노출된 API, 웹 애플리케이션, 또는 클라우드 리소스를 탐색한다. Nmap, Shodan 등 스캐닝 도구를 사용하여 인증 없이 접근 가능한 엔드포인트를 찾고, 
            금융 기관 내부 시스템에 침투할 수 있는 공격 지점을 파악한다. 이를 통해 피싱 공격을 위한 정보를 수집하고 공격 계획을 수립한다.
        </p>
    </li>
    <li>
        <h3>2. RAT 설치</h3>
        <p>
            해커는 타겟 금융 기관의 직원(연구원, 관리자 등)에게 스피어 피싱 이메일을 발송한다. 이메일에는 악성 파일(예: *.chm, *.lnk)이 첨부되어 있으며, 피해자가 이를 실행하면 
            RAT(Remote Access Trojan)이 설치된다. RAT은 공격자가 피해자의 PC를 원격으로 제어할 수 있도록 하며, 추가 권한을 획득할 수 있게 한다.
        </p>
    </li>
    <li>
        <h3>3. SOCKS5 프록시 탐지 우회</h3>
        <p>
            공격자는 <strong>SOCKS5 프록시</strong>를 사용하여 네트워크 보안 장치를 우회하고, 자신의 IP 주소를 숨긴다. 이를 통해 데이터 유출 및 백도어 설치 활동을 탐지하기 어렵게 만든다.
        </p>
    </li>
    <li>
        <h3>4. IAM 권한 획득</h3>
        <p>
            해커는 RAT을 통해 피해자의 AWS 자격 증명을 탈취한다. AWS IAM 권한을 활용해 클라우드 인프라에 접근하고, DynamoDB나 S3와 같은 리소스에 대한 접근 권한을 확보한다. 
            이를 통해 클라우드 리소스의 데이터와 설정을 제어할 수 있게 된다.
        </p>
    </li>
    <li>
        <h3>5. 고객 정보 데이터베이스 접근</h3>
        <p>
            IAM 권한을 활용하여 DynamoDB 또는 S3 버킷에 저장된 고객 데이터를 탐색하고 접근한다. 고객 정보(예: 개인 식별 정보, 금융 거래 기록)를 읽거나 다운로드한다. 
            데이터 접근은 클라우드 보안 정책이 부적절하게 설정된 경우 더욱 용이하기에 해커는 데이터를 손쉽게 탈취할 수 있게 된다.
        </p>
    </li>
    <li>
        <h3>6. 백도어 설치</h3>
        <p>
            해커는 클라우드 인프라(S3 버킷, EC2 인스턴스)에 백도어를 설치하여 지속적으로 시스템에 접근할 수 있는 거점을 마련한다. 이를 통해 데이터베이스와 애플리케이션 제어를 유지하며 추가 공격을 준비한다.
        </p>
    </li>
    <li>
        <h3>7. 고객 민감 데이터 유출</h3>
        <p>
            AWS IAM 권한이 과도하거나 S3 버킷이 Public 설정된 경우, 데이터를 다운로드하거나 변경할 수 있다. 탈취한 고객 데이터를 공격자의 외부 서버로 전송한다. 
            금융 거래 기록, 개인 정보, 투자 정보 등 민감 데이터를 악용하여 금전적 이익을 취하거나 다크웹에서 제3자에게 판매한다.
        </p>
    </li>
    <li>
        <h3>8. 학습 데이터 접근</h3>
        <p>
            클라우드에 저장된 AI 모델 학습 데이터에 접근한다. 모델 학습에 사용되는 데이터(고객 거래 내역, 금융 패턴 등)를 탐색하거나 복사한다.
        </p>
    </li>
    <li>
        <h3>9. 학습 데이터 변조</h3>
        <p>
            해커는 S3에 저장된 학습 데이터를 변조하여 AI 모델의 예측 결과 정확성을 저하시킨다. 또한 Amazon Athena와 QuickSight로 시각화된 데이터가 왜곡되어 
            마케팅 팀이 잘못된 결정을 내릴 가능성이 높아진다.
        </p>
    </li>
    <li>
        <h3>10. 서비스 오류 발생</h3>
        <p>
            앞 단계에서 이뤄진 데이터 유출 및 변조로 인해 AI 모델과 애플리케이션이 제대로 작동하지 않고 전체 서비스에 장애가 발생하게 된다. 
            해당 서비스와 금융기관의 신뢰도를 하락시키고 금융 기관의 운영에 영향을 끼치게 된다.
        </p>
    </li>
</ol>

<h2>대응책</h2>
<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "execute-api:Invoke",
      "Resource": "arn:aws:execute-api:region:account-id:api-id/stage-name/*",
      "Condition": {
        "StringNotEquals": {
          "aws:SourceIp": ["192.168.1.0/24", "203.0.113.0/24"]
        }
      }
    }
  ]
}
</code>
</pre>
<p>
    공개된 엔드포인트 탐색을 방지하기 위해 API Gateway와 WAF를 설정하고, 정기적인 취약점 점검과 IP 화이트리스트를 적용해야 한다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::your-bucket/*",
      "Condition": {
        "StringLike": {
          "s3:prefix": ["*.exe", "*.lnk", "*.chm"]
        }
      }
    }
  ]
}
</code>
</pre>
<p>
    스피어 피싱 공격으로 인한 RAT 설치를 막기 위해 이메일 필터링 시스템을 구축하고, 직원 보안 교육을 통해 피싱 이메일을 식별할 수 있도록 해야 한다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "BoolIfExists": {
          "aws:MultiFactorAuthPresent": "false"
        }
      }
    }
  ]
}
</code>
</pre>


<p>
    또한, EDR 솔루션을 활용하여 악성 파일 실행을 차단해야 한다. SOCKS5 프록시 탐지 우회를 방지하기 위해 TLS 암호화를 적용하고 
    로그 분석 시스템으로 비정상 트래픽을 감지해야 하며, IAM 권한 탈취를 막기 위해 최소 권한 원칙과 다단계 인증(MFA)을 활성화하고 
    AWS CloudTrail로 액세스를 모니터링해야 한다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "BoolIfExists": {
          "aws:MultiFactorAuthPresent": "false"
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::example-bucket",
        "arn:aws:s3:::example-bucket/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:GetItem",
        "dynamodb:Query"
      ],
      "Resource": "arn:aws:dynamodb:us-east-1:123456789012:table/ExampleTable"
    }
  ]
}
</code>
</pre>

<p>
    고객 정보 데이터베이스 접근을 차단하기 위해 S3 및 DynamoDB를 Private으로 설정하고, 데이터를 암호화해 저장하며 로그를 정기적으로 분석해야 한다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::your-bucket/*",
      "Condition": {
        "StringEquals": {
          "aws:PrincipalType": "Anonymous"
        }
      }
    },
    {
      "Effect": "Allow",
      "Action": "s3:PutObject",
      "Resource": "arn:aws:s3:::your-bucket/*",
      "Condition": {
        "StringEquals": {
          "s3:x-amz-server-side-encryption": "AES256"
        }
      }
    }
  ]
}
</code>
</pre>

<p>
    백도어 설치를 예방하기 위해 EC2 인스턴스에 최신 패치를 적용하고 보안 그룹 설정을 강화해야 한다.
</p>

<pre>
<code>
{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "SecurityGroup": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Allow only specific IP",
        "VpcId": "vpc-12345678",
        "SecurityGroupIngress": [
          {
            "IpProtocol": "tcp",
            "FromPort": 443,
            "ToPort": 443,
            "CidrIp": "203.0.113.0/24"
          }
        ]
      }
    }
  }
}
</code>
</pre>

<p>
    또한 고객 민감 데이터 유출을 방지하기 위해 AWS Macie를 활용해 실시간 데이터 모니터링과 네트워크 격리를 실행해야 한다.
</p>

<pre>
<code>
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "macie2:*",
      "Resource": "*"
    }
  ]
}
</code>
</pre>